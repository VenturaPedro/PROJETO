<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Cadastro</title>
    <link rel="shortcut icon" type="image/ico" href="/frontend/imagem/logo.png" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
</head>
<body id="painel">
    <nav>
        <div class="menu">  
            <div class="menu-item">
                <img src="/imagem/logoCash.png" alt="logo">
            </div>
            <div class="menu-item">
                <a href="/listar-clientes"><button class="btn"><i class="fas fa-home"></i><br>Dashboard</button></a>
            </div>
            <div class="menu-item">
                <a href="/listar-pedidos"><button id="pedido" class="btn"><i class="fa-solid fa-cash-register"></i><br>Pedidos</button></a>
            </div>
            <div class="menu-item">
                <button class="btn"><i class="fa-solid fa-truck"></i><br>Entrega</button>
            </div>
            <div class="menu-item">
                <a href="painel.html"><button class="btn"><i class="fa-solid fa-gears"></i><br>Painel</button></a>
            </div>
        </div> 
    </nav>
    <main id="painel-main-prod">
        <div id="btn-painel-cadastros">
            <nav id="painel-1">
                <button id="btn-cadastrarProduto"><i class="fa-solid fa-calendar-day"></i><br>Relatório Diário</button>
            </nav>   
            <nav id="painel-2">
                <button id="btn-cadastrarEstoque" onclick="gerarRelatorioPedidosComBusca()"><i class="fa-solid fa-calendar-days"></i><br>Relatório Mensal</button>
            </nav>
        </div>
    </main>
    <footer>
        <!-- Seu código de rodapé -->
    </footer>
    <script>

async function gerarRelatorioPedidosComBusca() {
    try {
        const atendenteId = sessionStorage.getItem("role");
        const usuario = atendenteId ? `Usuário: ${atendenteId}` : 'Usuário não especificado';
        const dataHoraGeracao = new Date().toLocaleString();

        // Obtém o valor total dos pedidos
        const responsePedidos = await axios.get('/soma-valor-total-pedidos');
        const totalPedidos = parseFloat(responsePedidos.data.total);

        // Obtém o valor total das despesas
        const responseDespesas = await axios.get('/soma-valor-total-despesas');
        const totalDespesas = parseFloat(responseDespesas.data.totalDespesas);

        // Calcula o lucro total
        const lucroTotal = totalPedidos - totalDespesas;

        // Verifica se os valores são números válidos
        if (!isNaN(totalPedidos) && !isNaN(totalDespesas) && !isNaN(lucroTotal)) {
            // Definição do conteúdo do documento PDF usando os dados obtidos
            const conteudoPDF = {
                content: [
                    { text: 'Relatório Financeiro', style: 'header' },
                    { text: '\n' }, // Espaço em branco
                    { text: usuario, style: 'info' },
                    { text: `Data e hora da geração: ${dataHoraGeracao}`, style: 'info' },
                    {
                        text: `Total dos Pedidos: R$ ${totalPedidos.toFixed(2)}`,
                        style: 'total'
                    },
                    {
                        text: `Total das Despesas: R$ ${totalDespesas.toFixed(2)}`,
                        style: 'total'
                    },
                    {
                        text: `Lucro Total: R$ ${lucroTotal.toFixed(2)}`,
                        style: 'total'
                    },
                    { text: '\n' } // Espaço em branco
                ],
                styles: {
                    header: {
                        fontSize: 18,
                        bold: true,
                        alignment: 'center'
                    },
                    info: {
                        fontSize: 14,
                        alignment: 'center'
                    },
                    total: {
                        fontSize: 14,
                        bold: true,
                        alignment: 'center'
                    }
                }
            };

            // Criação do documento PDF
            const pdfDoc = pdfMake.createPdf(conteudoPDF);
            pdfDoc.open();
        } else {
            console.error('Um ou mais valores não são números válidos.');
        }
    } catch (error) {
        console.error('Erro ao gerar o relatório financeiro:', error);
    }
}



    </script>
    <script type="module" src="scripts/relatorio.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>

        
    